#!/usr/bin/env bash
#
# Pulls a markdown file from devhints.io, if it exists, and opens it in vim
#
# adapted from: https://dev.to/koenighotze/cheat-sheets-in-your-terminal--1dli
#
# USAGE:
#    $ devhints vim
#    # => will open devhints.io's vim hints in vim
type wget >/dev/null 2>&1 || { echo >&2 "I require wget but it's not installed."; exit 1; }
type vi >/dev/null 2>&1 || { echo >&2 "I require vi but it's not installed."; exit 1; }

TOOL=${1:?Usage: devhints <toolname> [--refresh]}
REFRESH=${2:-no}

RAW_MD_URL="https://raw.github.com/hazeorid/devhints.io/gh-pages/${TOOL}.md"

CACHE_DIR=$HOME/.devhints/
LOCAL_CACHE_FILE=$CACHE_DIR/${TOOL}.md

if [ ! -d $CACHE_DIR ]; then
  mkdir -p $CACHE_DIR
fi

if [ "$REFRESH" == "--refresh" ] || [ ! -e $LOCAL_CACHE_FILE ]; then
  wget -q -O - $RAW_MD_URL | sed -e '/^{: /d' > $LOCAL_CACHE_FILE
fi

if [ -s $LOCAL_CACHE_FILE ]; then
  vi $LOCAL_CACHE_FILE 2>/dev/null
else
  echo No hints for ${TOOL} were found!
fi

